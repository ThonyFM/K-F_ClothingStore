@model IEnumerable<K_F_ClothingStore.Models.DetalleFactura>

@{
    ViewData["Title"] = "Solicitar Devolución";
}

<div class="container py-5">
    <h2 class="mb-4 title-animated">Solicitar Devolución de Productos</h2>

    @if (TempData["Exito"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["Exito"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="grid-container">
        @foreach (var item in Model)
        {
            <div class="card glassmorphism hover-effect card-3d">
                <div class="card-3d-inner p-4">
                    <h5 class="card-title">@item.NombreProducto</h5>
                    <p class="card-text"><strong>Precio Unitario:</strong> ₡@item.PrecioUnitario.ToString("N2")</p>
                    <p class="card-text"><strong>Cantidad Comprada:</strong> @item.Cantidad</p>
                    <p class="card-text"><strong>Fecha de Compra:</strong> @item.FechaFactura.ToString("dd/MM/yyyy")</p>

                    <form asp-action="SolicitarDevolucion" method="post" class="mt-3">
                        <input type="hidden" name="detalleFacturaID" value="@item.ID" />

                        <div class="mb-2">
                            <label class="form-label">Cantidad a devolver:</label>
                            <input type="number" name="cantidad" min="1" max="@item.Cantidad" value="1" class="form-control" required />
                        </div>

                        <div class="mb-2">
                            <label class="form-label">Motivo:</label>
                            <textarea name="motivo" rows="2" class="form-control" required></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary btn-shine w-100 mt-3">
                            Solicitar Devolución
                        </button>
                    </form>
                </div>
            </div>
        }
    </div>

    <div class="text-center mt-5">
        <a asp-controller="Home" asp-action="Index" class="btn btn-outline btn-shine">Volver a Inicio</a>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const successMessage = '@TempData["Exito"]';
            const errorMessage = '@TempData["Error"]';

            if (successMessage) {
                Swal.fire({
                    icon: 'success',
                    title: '¡Solicitud enviada!',
                    text: successMessage,
                    confirmButtonColor: '#2563eb'
                });
            }

            if (errorMessage) {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: errorMessage,
                    confirmButtonColor: '#ef4444'
                });
            }
        });
    </script>
}